<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Big-M Simplex Visualizer</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 40px; background: #f4f7f6; }
        .container { max-width: 1100px; margin: auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .input-section { background: #eef2f7; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        input[type="text"] { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; font-size: 0.9em; }
        th, td { border: 1px solid #aaa; padding: 8px; text-align: center; min-width: 50px; }
        .obj-row { background: #fff9c4; font-weight: bold; }
        .header-row { background: #eee; font-style: italic; }
        .step-card { border-left: 5px solid #4A90E2; padding: 15px; margin-bottom: 40px; background: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        button { background: #4A90E2; color: white; border: none; padding: 10px 25px; border-radius: 4px; cursor: pointer; font-size: 1em; }
        button:hover { background: #357ABD; }
        .divider { border-bottom: 2px solid #333; }
        .pivot-cell { color: red; font-weight: bold; position: relative; }
        .pivot-marker { color: red; vertical-align: super; font-size: 1.2em; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Big-M Simplex Visualizer</h1>
        
        <div class="input-section">
            <h3>Problem Input</h3>
            <div class="input-group">
                <label>Objective Function c_T (comma separated, use 'M' for Big-M):</label>
                <input type="text" id="c_T" value="2, 4, 0, 0, M, M">
            </div>
            <div class="input-group">
                <label>Constraint Matrix A (rows separated by semicolon, values by comma):</label>
                <input type="text" id="A" value="1, 2, -1, 0, 1, 0; -1, 2, 0, -1, 0, 1">
            </div>
            <div class="input-group">
                <label>RHS Vector b_T (comma separated):</label>
                <input type="text" id="b_T" value="4, 6">
            </div>
            <button onclick="solveCustomProblem()">Solve Problem</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        async function solveCustomProblem() {
            const c_T_val = document.getElementById('c_T').value.split(',').map(s => s.trim());
            const b_T_val = document.getElementById('b_T').value.split(',').map(s => parseFloat(s.trim()));
            const A_val = document.getElementById('A').value.split(';').map(row => 
                row.split(',').map(s => parseFloat(s.trim()))
            );

            const payload = { "c_T": c_T_val, "A": A_val, "b_T": b_T_val };

            const response = await fetch('http://127.0.0.1:5000/solve', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const data = await response.json();
            if (data.error) alert(data.error);
            else renderSteps(data.steps, c_T_val);
        }

        const numVars = original_c.length;
        const x = Array(numVars).fill(0);

        // Assign b values to basic variables
        step.basis.forEach((varIndex, rowIndex) => {
            if (varIndex < numVars) {
                x[varIndex] = step.b[rowIndex];
            }
        });

        // Helper to format numbers for the UI
        function smartFormat(num) {
            // If it's an integer or close enough to one, don't show decimals
            return Number.isInteger(num) ? num.toString() : parseFloat(num.toFixed(4)).toString();
        }

        function formatRC(r, m) {
            if (Math.abs(m) < 1e-6) return smartFormat(r);
            
            let mPart = "";
            if (m === 1) mPart = "M";
            else if (m === -1) mPart = "-M";
            else mPart = smartFormat(m) + "M";

            let rPart = "";
            if (Math.abs(r) > 1e-6) {
                rPart = (r > 0 ? " + " : " - ") + smartFormat(Math.abs(r));
            }
            return mPart + rPart;
        }

        function renderSteps(steps, original_c) {
            const container = document.getElementById('results');
            container.innerHTML = '<h2>Solver Iterations</h2>';

            steps.forEach((step, index) => {
                const stepDiv = document.createElement('div');
                stepDiv.className = 'step-card';
                
                // Build the table based on your requested layout
                let tableHtml = `<table>`;
                
                // Top row: x labels and original coefficients
                tableHtml += `<tr class="header-row">
                                <td>x</td>
                                ${original_c.map(c => `<td>${c}</td>`).join('')}
                            </tr>`;

                
                // Objective row (c_j - z_j)
                tableHtml += `<tr class="obj-row">
                    <td>${formatRC(step.neg_obj_R, step.neg_obj_M)}</td>
                    ${step.r_R.map((r, i) => `<td>${formatRC(r, step.r_M[i])}</td>`).join('')}
                </tr>`;

                // Data rows
                step.A.forEach((row, i) => {
                    tableHtml += `<tr>
                        <td style="background:#f9f9f9"><b>${smartFormat(step.b[i])}</b></td>
                        ${row.map((val, j) => {
                            const isPivot = (step.next_pivot[0] === i && step.next_pivot[1] === j);
                            return `<td>
                                ${smartFormat(val)}
                                ${isPivot ? '<span class="pivot-marker">*</span>' : ''}
                            </td>`;
                        }).join('')}
                    </tr>`;
                });


                tableHtml += `</table>`;
                stepDiv.innerHTML = `<h3>Step ${index}</h3>` + tableHtml;
                container.appendChild(stepDiv);
            });
        }
    </script>
</body>
</html>