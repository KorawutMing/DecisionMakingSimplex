<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Big-M Simplex Visualizer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="container">
        <div style="text-align: center; margin-bottom: 20px;">
            <img src="https://upload.wikimedia.org/wikipedia/commons/e/ec/Tsinghua_University_Logo.svg" 
            alt="Tsinghua University Logo" 
            style="max-width: 180px; height: auto; display: block; margin: 0 auto;">
        </div>

        <h1>Big-M Simplex Visualizer</h1>
        <p class="subtitle">Visualize the Big-M method step-by-step with enhanced clarity</p>

        <div style="margin-top: -10px; margin-bottom: 30px; color: #666; font-size: 0.95em;">
            <p>Work for: <strong>Introduction to Decision Making (70160513-0)</strong></p>
            <p>Instructor: <strong>Prof. Hai Jiang</strong></p>
        </div>
        
        <div class="input-mode-toggle">
            <button class="mode-btn active" onclick="switchMode('standard')">Standard Input</button>
            <button class="mode-btn" onclick="switchMode('string')">Standardized String</button>
            <button class="mode-btn" onclick="switchMode('copt')">COPT LP Style</button>
        </div>

        <div id="standard-input" class="input-section">
            <h3>Tableau Grid Configuration</h3>
            
            <div class="options-row" style="margin-bottom: 20px; background: rgba(111, 26, 143, 0.05); padding: 15px; border-radius: 10px;">
                <div class="input-group">
                    <label>Number of Variables (n):</label>
                    <input type="number" id="num_vars" value="6" min="1" style="width: 80px; padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                </div>
                <div class="input-group">
                    <label>Number of Constraints (m):</label>
                    <input type="number" id="num_cons" value="2" min="1" style="width: 80px; padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                </div>
            </div>

            <div id="grid-wrapper" class="tableau-grid-container" style="overflow-x: auto; margin-bottom: 25px;">
            </div>

            <div class="options-row">
                <div class="input-group">
                    <label>Optimization Type:</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="opt_type" value="min" checked> Minimize
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="opt_type" value="max"> Maximize
                        </label>
                    </div>
                </div>
                <div class="input-group">
                    <label>Pivot Rule:</label>
                    <select id="pivot_rule">
                        <option value="bland">Bland's Rule</option>
                        <option value="max">Maximum Coefficient</option>
                    </select>
                </div>
            </div>

            <button onclick="solveFromGrid()">
                <span id="buttonText1">Solve Problem</span>
            </button>
        </div>

        <!-- Standardized String Input Mode -->
        <div id="tableau-input" class="input-section hidden">
            <h3>Problem Configuration (Standardized String)</h3>
            <div class="input-group">
                <label>Problem Specification (multi-line format):</label>
                <textarea id="problem_string" rows="8" placeholder="c: 2, 4, 0, 0, M, M
A: 1, 2, -1, 0, 1, 0; -1, 2, 0, -1, 0, 1
b: 4, 6
obj: min
rule: max_coeff"></textarea>
                <div class="hint-text">
                    Format: Each line starts with a key followed by colon.<br>
                    <strong>c:</strong> objective coefficients (use M for Big-M)<br>
                    <strong>A:</strong> constraint matrix (rows separated by semicolons)<br>
                    <strong>b:</strong> right-hand side values<br>
                    <strong>obj:</strong> min or max<br>
                    <strong>rule:</strong> bland or max_coeff
                </div>
            </div>
            <button onclick="solveStandardizedString()">
                <span id="buttonText2">Solve Problem</span>
            </button>
        </div>

        <!-- COPT LP Style Input Mode -->
        <div id="copt-input" class="input-section hidden">
            <h3>COPT LP Format (Uses Bland's Rule)</h3>
            <div class="input-group">
                <label>LP Problem in COPT Format:</label>
                <textarea id="copt_string" rows="12" placeholder="Minimize
 OBJ: -0.75 x1 + 20 x2 - 0.5 x3 + 6 x4 + 0 x5 + 0 x6 + 0 x7
Subject To
 C1: 0.25 x1 - 8 x2 - 1 x3 + 9 x4 + 1 x5 + 0 x6 + 0 x7 = 0
 C2: 0.5 x1 - 12 x2 - 0.5 x3 + 3 x4 + 0 x5 + 1 x6 + 0 x7 = 0
 C3: 0 x1 + 0 x2 + 1 x3 + 0 x4 + 0 x5 + 0 x6 + 1 x7 = 1
Bounds
 x1 >= 0
 x2 >= 0
 x3 >= 0
 x4 >= 0
 x5 >= 0
 x6 >= 0
 x7 >= 0
End"></textarea>
                <div class="hint-text">
                    <strong>Format:</strong> Standard COPT LP format<br>
                    <strong>Reference (LP format):</strong> https://guide.coap.online/copt/en-doc/fileformats.html<br>
                    <em>Note: This mode always uses Bland's rule to prevent cycling, and we only allow equality in the constraints</em>
                </div>
            </div>
            <button onclick="solveCOPTString()">
                <span id="buttonText3">Solve Problem</span>
            </button>
        </div>

        <div id="results"></div>

        <div id="path-controls" style="margin: 20px 0; display: none;">
            <label><strong>Select variables to visualize:</strong></label>
            <select id="x-select-1"></select>
            <select id="x-select-2"></select>
            <button onclick="drawSimplexPath()">Show Simplex Path</button>
        </div>

        <canvas id="simplex-canvas" width="600" height="600"
            style="border:1px solid #ccc; margin-top:20px; display:none;"></canvas>
    </div>
    
    <!-- Load JavaScript modules -->
    <script type="module" src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
